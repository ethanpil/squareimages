<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Squarer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 24px;
        }

        .input-group {
            margin-bottom: 20front;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-group.url-group {
            margin-bottom: 30px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        input[type="text"],
        input[type="number"],
        input[type="url"] {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="url"]:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
        }

        button {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.3s;
        }

        button:hover {
            background: #45a049;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .image-info {
            margin-bottom: 15px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }

        .info-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .dimensions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dimensions label {
            margin: 0;
            font-weight: 600;
            color: #333;
        }

        .dimensions span {
            font-size: 18px;
            color: #4CAF50;
            font-weight: 500;
        }

        .filename-input {
            flex: 1;
            min-width: 250px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filename-input label {
            margin: 0;
            white-space: nowrap;
        }

        .filename-input input {
            flex: 1;
        }

        #canvas-container {
            width: 100%;
            aspect-ratio: 1;
            border: 2px dashed #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
            background: white;
            overflow: hidden;
        }

        #canvas-container.dragover {
            border-color: #4CAF50;
            background: #f0f8f0;
        }

        #canvas-container .placeholder {
            color: #999;
            text-align: center;
            padding: 20px;
        }

        canvas {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }

        #downloadBtn {
            width: 100%;
            padding: 12px;
            font-size: 16px;
        }

        #clearBtn {
            background-color: #f44336;
            margin-top: 10px;
            width: 100%;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        div#footer {
            text-align: center;
            font-size: .9em;
            color: #777;
            padding-top: 1em;
            font-family: monospace;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 20px;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Image Squarer Tool</h1>
        
        <div class="input-group url-group">
            <input type="url" id="imageUrl" placeholder="Image URL">
            <button id="getImageBtn">Get Image</button>
        </div>

        <div class="settings-grid">
            <div class="setting-item">
                <label for="maxPixels">Maximum Pixels per Side</label>
                <input type="number" id="maxPixels" value="1280" min="100" max="5000">
            </div>
            <div class="setting-item">
                <label for="paddingPixels">Padding Pixels</label>
                <input type="number" id="paddingPixels" value="20" min="0" max="200">
            </div>
            <div class="setting-item">
                <label for="jpegQuality">JPEG Quality</label>
                <input type="number" id="jpegQuality" value="88" min="1" max="100">
            </div>
        </div>

        <div class="image-info" style="display: none;">
            <div class="info-row">
                <div class="dimensions">
                    <label>Final Dimensions:</label>
                    <span id="dimensionsText">-</span>
                </div>
                <div class="filename-input">
                    <label for="filename">Filename:</label>
                    <input type="text" id="filename" placeholder="Leave blank for auto-generated name">
                </div>
            </div>
        </div>

        <div id="canvas-container">
            <div class="placeholder">
                Drag & drop an image here<br>
                or paste from clipboard<br>
                or enter URL above
            </div>
            <canvas id="canvas" style="display: none;"></canvas>
        </div>

        <button id="downloadBtn" disabled>Download Processed Image</button>
        <button id="clearBtn">Clear</button>
        
        <div id="status" class="status"></div>
    </div>
    <div id="footer">Developed by <a href="http://piliavin.com">Ethan Piliavin</a>a> with <a href="http://claude.ai">Claude Opus 4.1</a>a> and <a href="http://jules.google.com">Google Jules</a>a>. Open source via <a href="http://https://github.com/ethanpil/squareimages/">GitHub</a>a>.</div>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const canvasContainer = document.getElementById('canvas-container');
        const imageUrlInput = document.getElementById('imageUrl');
        const getImageBtn = document.getElementById('getImageBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const maxPixelsInput = document.getElementById('maxPixels');
        const paddingPixelsInput = document.getElementById('paddingPixels');
        const jpegQualityInput = document.getElementById('jpegQuality');
        const statusDiv = document.getElementById('status');
        const placeholder = canvasContainer.querySelector('.placeholder');
        const dimensionsText = document.getElementById('dimensionsText');
        const filenameInput = document.getElementById('filename');
        const imageInfo = document.querySelector('.image-info');
        const clearBtn = document.getElementById('clearBtn');

        let processedImageData = null;

        function showStatus(message, isError = false) {
            statusDiv.textContent = message;
            statusDiv.className = isError ? 'status error' : 'status success';
            if (!isError) {
                setTimeout(() => {
                    statusDiv.className = 'status';
                }, 3000);
            }
        }

        function processImage(img) {
            try {
                const maxPixels = parseInt(maxPixelsInput.value) || 1280;
                const padding = parseInt(paddingPixelsInput.value) || 20;

                // Get original dimensions
                const origWidth = img.width;
                const origHeight = img.height;

                // Step 1: Square the image
                const maxDim = Math.max(origWidth, origHeight);
                const squareSize = maxDim + (padding * 2);

                // Step 2: Check if we need to resize
                let finalSize = squareSize;
                let scale = 1;
                if (squareSize > maxPixels) {
                    finalSize = maxPixels;
                    scale = maxPixels / squareSize;
                }

                // Set canvas size
                canvas.width = finalSize;
                canvas.height = finalSize;

                // Fill with white background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, finalSize, finalSize);

                // Calculate position to center the image
                const scaledWidth = origWidth * scale;
                const scaledHeight = origHeight * scale;
                const x = (finalSize - scaledWidth) / 2;
                const y = (finalSize - scaledHeight) / 2;

                // Draw the image centered
                ctx.drawImage(img, x, y, scaledWidth, scaledHeight);

                // Show canvas, hide placeholder, show info
                canvas.style.display = 'block';
                placeholder.style.display = 'none';
                imageInfo.style.display = 'block';

                // Update dimensions display
                dimensionsText.textContent = `${finalSize}x${finalSize}`;

                // Enable download button
                downloadBtn.disabled = false;

                showStatus(`Image processed: ${finalSize}x${finalSize}px`);
            } catch (error) {
                showStatus('Error processing image: ' + error.message, true);
            }
        }

        function loadImage(src) {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                processImage(img);
            };
            
            img.onerror = function() {
                showStatus('Error loading image. Please check the URL or try another image.', true);
            };
            
            img.src = src;
        }

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showStatus('Please select an image file.', true);
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                loadImage(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        // URL input handler
        getImageBtn.addEventListener('click', function() {
            const url = imageUrlInput.value.trim();
            if (!url) {
                showStatus('Please enter an image URL.', true);
                return;
            }
            loadImage(url);
        });

        // Enter key handler for URL input
        imageUrlInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                getImageBtn.click();
            }
        });

        // Drag and drop handlers
        canvasContainer.addEventListener('dragover', function(e) {
            e.preventDefault();
            canvasContainer.classList.add('dragover');
        });

        canvasContainer.addEventListener('dragleave', function(e) {
            e.preventDefault();
            canvasContainer.classList.remove('dragover');
        });

        canvasContainer.addEventListener('drop', function(e) {
            e.preventDefault();
            canvasContainer.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        // Paste handler
        document.addEventListener('paste', function(e) {
            const items = e.clipboardData.items;
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    const blob = items[i].getAsFile();
                    handleFile(blob);
                    break;
                }
            }
        });

        // Download handler
        downloadBtn.addEventListener('click', function() {
            const quality = (parseInt(jpegQualityInput.value) || 88) / 100;
            
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                // Use custom filename if provided, otherwise use default
                 //sanitize filename - replaces non alphanumeric and make lower case
                const customFilename = filenameInput.value.trim().replace(/[^a-z0-9]/gi, '_').toLowerCase();
                let filename;
                if (customFilename) {
                    // Ensure .jpg extension
                    filename = customFilename.endsWith('.jpg') || customFilename.endsWith('.jpeg') 
                        ? customFilename 
                        : customFilename + '.jpg';
                } else {
                    filename = `squared-image-${Date.now()}.jpg`;
                }
                
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showStatus('Image downloaded successfully!');
            }, 'image/jpeg', quality);
        });

        // Re-process on setting change
        function reprocessIfImageLoaded() {
            if (canvas.style.display !== 'none') {
                const tempImg = new Image();
                tempImg.onload = function() {
                    processImage(tempImg);
                };
                tempImg.src = canvas.toDataURL();
            }
        }

        function clearCanvas() {
            if (confirm('This action will remove the image and reset everything to default values. Continue?')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                canvas.style.display = 'none';
                placeholder.style.display = 'block';
                imageInfo.style.display = 'none';
                downloadBtn.disabled = true;

                imageUrlInput.value = '';
                filenameInput.value = '';
                maxPixelsInput.value = '1280';
                paddingPixelsInput.value = '20';
                jpegQualityInput.value = '88';
                dimensionsText.textContent = '-';

                statusDiv.className = 'status';
            }
        }

        maxPixelsInput.addEventListener('change', reprocessIfImageLoaded);
        paddingPixelsInput.addEventListener('change', reprocessIfImageLoaded);
        clearBtn.addEventListener('click', clearCanvas);
    </script>
</body>
</html>
